# N8N Workflow æ–‡æ¡£ - æ¨¡ç‰¹æ¢è£…åŠŸèƒ½

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°å¦‚ä½•ä½¿ç”¨ n8n æ„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–çš„æ¨¡ç‰¹æ¢è£…å·¥ä½œæµã€‚è¯¥å·¥ä½œæµå¯ä»¥è‡ªåŠ¨åˆ†ææœè£…å›¾ç‰‡ï¼Œå¹¶ç”Ÿæˆæ¨¡ç‰¹ç©¿ç€è¯¥æœè£…çš„AIå›¾ç‰‡ï¼ŒåŒæ—¶ç”Ÿæˆå°çº¢ä¹¦æ ‡é¢˜ã€‚

## å·¥ä½œæµæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§¦å‘å™¨/è¾“å…¥    â”‚
â”‚  (å›¾ç‰‡URL)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸Šä¼ åˆ°R2å­˜å‚¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPTåˆ†ææœè£…    â”‚
â”‚  (OpenRouter)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KIEç”Ÿæˆå›¾ç‰‡    â”‚
â”‚  (åˆ›å»ºä»»åŠ¡)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½®è¯¢ä»»åŠ¡çŠ¶æ€   â”‚
â”‚  (ç­‰å¾…å®Œæˆ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸‹è½½ç”Ÿæˆå›¾ç‰‡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆå°çº¢ä¹¦æ ‡é¢˜ â”‚
â”‚  (OpenRouter)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿å­˜åˆ°R2å­˜å‚¨   â”‚
â”‚  (å›¾ç‰‡+å…ƒæ•°æ®)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ç»“æœ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨ n8n ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡æˆ–å‡­è¯ï¼š

```bash
# OpenRouter API (ç”¨äºGPTåˆ†æ)
OPENROUTER_API_KEY=your_openrouter_api_key
SITE_URL=https://your-site.com
SITE_NAME=Your Site Name

# Cloudflare R2 (å¯¹è±¡å­˜å‚¨)
R2_ACCOUNT_ID=your_r2_account_id
R2_ACCESS_KEY_ID=your_r2_access_key_id
R2_SECRET_ACCESS_KEY=your_r2_secret_access_key
R2_BUCKET_NAME=your_bucket_name
R2_PUBLIC_BASE_URL=https://pub-xxx.r2.dev
R2_MODEL_BASE_URL=https://pub-xxx.r2.dev  # å¯é€‰ï¼Œæ¨¡ç‰¹å›¾ç‰‡å­˜å‚¨

# KIE API (å›¾ç‰‡ç”ŸæˆæœåŠ¡)
KIE_API_TOKEN=your_kie_api_token
KIE_CALLBACK_URL=https://your-site.com/api/callback  # å¯é€‰ï¼Œç”¨äºwebhookå›è°ƒ
```

## èŠ‚ç‚¹é…ç½®è¯¦è§£

### 1. è§¦å‘å™¨èŠ‚ç‚¹ (Webhook/Manual Trigger)

**èŠ‚ç‚¹ç±»å‹**: Webhook æˆ– Manual Trigger

**é…ç½®**:
```json
{
  "method": "POST",
  "path": "outfit-change",
  "responseMode": "lastNode"
}
```

**è¾“å…¥æ•°æ®æ ¼å¼**:
```json
{
  "imageUrl": "https://example.com/reference-image.jpg",
  "character": "lin",
  "extractTopOnly": false,
  "wearMask": false
}
```

**å‚æ•°è¯´æ˜**:
- `imageUrl`: å‚è€ƒæœè£…å›¾ç‰‡çš„URL (å¿…å¡«)
- `character`: æ¨¡ç‰¹è§’è‰²ï¼Œå¯é€‰å€¼: `lin`, `Qiao`, `qiao_mask`, `mature_woman` (å¿…å¡«)
- `extractTopOnly`: æ˜¯å¦åªæå–ä¸Šè£…ï¼Œé»˜è®¤ `false` (å¯é€‰)
- `wearMask`: æ¨¡ç‰¹æ˜¯å¦ä½©æˆ´ç™½è‰²å£ç½©ï¼Œé»˜è®¤ `false` (å¯é€‰)

---

### 2. ä¸Šä¼ å›¾ç‰‡åˆ°R2 (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "PUT",
  "url": "https://{{ $env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com/{{ $env.R2_BUCKET_NAME }}/uploads/{{ $now.format('YYYY-MM-DD') }}/{{ $randomUUID() }}.jpg",
  "authentication": "genericCredentialType",
  "genericAuthType": "awsS3",
  "sendBody": true,
  "bodyContentType": "raw",
  "rawBody": "={{ $binary.data }}"
}
```

**AWS S3 å‡­è¯é…ç½®**:
```
Access Key ID: {{ $env.R2_ACCESS_KEY_ID }}
Secret Access Key: {{ $env.R2_SECRET_ACCESS_KEY }}
Region: auto
Service: s3
```

**è¾“å‡º**:
- ä¸Šä¼ åçš„å…¬å¼€URL: `{{ $env.R2_PUBLIC_BASE_URL }}/uploads/...`

---

### 3. GPTåˆ†ææœè£… (HTTP Request to OpenRouter)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "POST",
  "url": "https://openrouter.ai/api/v1/chat/completions",
  "authentication": "genericCredentialType",
  "genericAuthType": "httpHeaderAuth",
  "sendHeaders": true,
  "headerParameters": {
    "parameters": [
      {
        "name": "Authorization",
        "value": "Bearer {{ $env.OPENROUTER_API_KEY }}"
      },
      {
        "name": "HTTP-Referer",
        "value": "{{ $env.SITE_URL }}"
      },
      {
        "name": "X-Title",
        "value": "{{ $env.SITE_NAME }}"
      }
    ]
  },
  "sendBody": true,
  "bodyContentType": "json"
}
```

**è¯·æ±‚ä½“ (æ™®é€šæ¨¡å¼)**:
```json
{
  "model": "openai/gpt-4o",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "Reverse engineer this image. è¿”å›è¯¦ç»†çš„ç©¿æ­çš„promptsï¼Œå°¤å…¶æ˜¯è¡£æœï¼ˆåŒ…æ‹¬å¥³ç”Ÿä¸ŠåŠèº«å’Œä¸‹åŠèº«çš„æ‰€æœ‰è¡£æœå’Œé‹å­ï¼Œå¦‚æœæ²¡æœ‰ç©¿ä¸è¢œåˆ™æç¤ºæ²¡æœ‰ä¸è¢œï¼‰çš„ç»†èŠ‚ï¼Œå¿½ç•¥äººç‰©çš„å‘å‹ã€é•¿ç›¸ã€å§¿åŠ¿ã€èƒŒæ™¯ï¼Œæ³¨æ„å…‰çº¿ç…§åœ¨è¡£æœä¸Šçš„ç»†èŠ‚ï¼Œå¥³ç”Ÿçš®è‚¤ç™½çš™ä¸è¦å‘é»„ï¼Œæ­£å¸¸ç©¿æ­ï¼Œä¸æ˜¯å…¬ä¼—äººç‰©ã€‚\n\nè¯·è¯¦ç»†æè¿°å›¾ç‰‡ä¸­äººç‰©çš„ç©¿æ­ï¼ŒåŒ…æ‹¬ï¼š\n1. ä¸Šè£…ï¼šæ¬¾å¼ã€é¢œè‰²ã€æè´¨ã€è®¾è®¡ç»†èŠ‚ï¼ˆé¢†å£ã€è¢–å­ã€å›¾æ¡ˆç­‰ï¼‰ã€å…‰çº¿åå°„æ•ˆæœ\n2. ä¸‹è£…ï¼šæ¬¾å¼ã€é¢œè‰²ã€æè´¨ã€è®¾è®¡ç»†èŠ‚ï¼ˆè£¤å‹ã€è£™å‹ã€é•¿åº¦ç­‰ï¼‰ã€å…‰çº¿åå°„æ•ˆæœ\n3. ä¸è¢œ/æ‰“åº•è£¤ï¼šå¦‚æœæœ‰ç©¿ä¸è¢œæˆ–æ‰“åº•è£¤ï¼Œæè¿°å…¶é¢œè‰²ã€åšåº¦ã€è´¨æ„Ÿï¼›å¦‚æœæ²¡æœ‰ç©¿ï¼Œæ˜ç¡®è¯´æ˜\"æ²¡æœ‰ç©¿ä¸è¢œ\"\n4. é‹å­ï¼šå¦‚æœå›¾ç‰‡ä¸­èƒ½çœ‹åˆ°é‹å­ï¼šè¯¦ç»†æè¿°é‹å‹ã€é¢œè‰²ã€æè´¨ã€é‹è·Ÿé«˜åº¦ã€æ¬¾å¼ç‰¹å¾\n5. é…é¥°ç»†èŠ‚ï¼šåŒ…åŒ…ã€é¦–é¥°ã€å¸½å­ã€çœ¼é•œã€è…°å¸¦ã€å£ç½©ç­‰\n6. æ•´ä½“é£æ ¼ï¼šç©¿æ­é£æ ¼å®šä½ï¼ˆå¦‚ä¼‘é—²ã€æ­£å¼ã€è¡—å¤´ã€ä¼˜é›…ç­‰ï¼‰\n7. å…‰å½±ç»†èŠ‚ï¼šå…‰çº¿å¦‚ä½•ç…§å°„åœ¨è¡£æœä¸Šï¼Œæè´¨çš„å…‰æ³½æ„Ÿã€é˜´å½±æ•ˆæœ\n\né‡è¦æé†’ï¼š\n- å¿…é¡»æè¿°å®Œæ•´çš„æ­é…ï¼ŒåŒ…æ‹¬ä¸Šè£…ã€ä¸‹è£…å’Œé‹å­ï¼ˆçœ‹å¾—è§åˆ™æè¿°ï¼Œçœ‹ä¸è§åˆ™æ¨èï¼‰\n- æ³¨é‡ç»†èŠ‚ï¼ŒåŒ…æ‹¬é¢œè‰²ã€æè´¨ã€å›¾æ¡ˆã€å‰ªè£ã€å…‰å½±æ•ˆæœç­‰\n- å¿½ç•¥äººç‰©çš„å‘å‹ã€é•¿ç›¸ã€å§¿åŠ¿ã€èƒŒæ™¯\n- å¼ºè°ƒå¥³ç”Ÿçš®è‚¤ç™½çš™ï¼Œä¸è¦å‘é»„\n\nè¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œå°½å¯èƒ½è¯¦ç»†å’Œå‡†ç¡®ã€‚"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "={{ $json.uploadedUrl }}"
          }
        }
      ]
    }
  ],
  "max_tokens": 4000,
  "temperature": 0.7
}
```

**è¯·æ±‚ä½“ (åªæå–ä¸Šè£…æ¨¡å¼, extractTopOnly=true)**:
```json
{
  "model": "openai/gpt-4o",
  "messages": [
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "Reverse engineer this image. åªæå–å’Œæè¿°å›¾ç‰‡ä¸­äººç‰©çš„ä¸Šè£…ä¿¡æ¯ï¼Œå®Œå…¨å¿½ç•¥ä¸‹è£…ã€é‹å­å’Œé…é¥°ã€‚\n\nè¯·è¯¦ç»†æè¿°å›¾ç‰‡ä¸­äººç‰©çš„ä¸Šè£…ï¼ŒåŒ…æ‹¬ï¼š\n1. ä¸Šè£…ç±»å‹ï¼šä¸Šè¡£/å¤–å¥—/è¡¬è¡«/Tæ¤/æ¯›è¡£/èƒŒå¿ƒç­‰å…·ä½“ç±»å‹\n2. é¢œè‰²ç»†èŠ‚ï¼šä¸»è‰²è°ƒå’Œè¾…åŠ©è‰²ã€é¢œè‰²åˆ†å¸ƒå’Œæ­é…ã€è‰²å½©é¥±å’Œåº¦å’Œæ˜æš—åº¦\n3. æè´¨ç‰¹å¾ï¼šé¢æ–™ç±»å‹ï¼ˆæ£‰ã€ä¸ã€é’ˆç»‡ã€ç‰›ä»”ã€é›ªçººã€éº»ã€çš®é©ç­‰ï¼‰ã€æè´¨è´¨æ„Ÿï¼ˆæŸ”è½¯ã€æŒºæ‹¬ã€å…‰æ»‘ã€ç²—ç³™ç­‰ï¼‰ã€åšåº¦å’Œé€æ°”æ€§\n4. è®¾è®¡ç»†èŠ‚ï¼šé¢†å£ç±»å‹å’Œè®¾è®¡ã€è¢–å­æ¬¾å¼ã€è¢–å£è®¾è®¡ã€å›¾æ¡ˆ/å°èŠ±/åˆºç»£ã€çº½æ‰£/æ‹‰é“¾/ç³»å¸¦ã€å£è¢‹è®¾è®¡ã€è¡£èº«å‰ªè£ã€è¡£é•¿ã€ä¸‹æ‘†è®¾è®¡\n5. å…‰å½±æ•ˆæœï¼šå…‰çº¿å¦‚ä½•ç…§å°„åœ¨ä¸Šè£…ä¸Šã€æè´¨çš„å…‰æ³½æ„Ÿã€è¤¶çš±å’Œé˜´å½±ç»†èŠ‚\n6. æ•´ä½“é£æ ¼ï¼šåŸºäºä¸Šè£…åˆ¤æ–­çš„ç©¿æ­é£æ ¼\n\né‡è¦æé†’ï¼š\n- **åªæè¿°ä¸Šè£…ï¼Œç»å¯¹ä¸è¦æåŠä»»ä½•ä¸‹è£…ï¼ˆè£¤å­ã€è£™å­ç­‰ï¼‰ã€é‹å­ã€é…é¥°**\n- å¿½ç•¥äººç‰©çš„å‘å‹ã€é•¿ç›¸ã€å§¿åŠ¿ã€èƒŒæ™¯\n- æ³¨é‡ç»†èŠ‚å’Œå‡†ç¡®æ€§ï¼Œæè¿°è¦å…·ä½“ä¸”è¯¦ç»†\n- å¥³ç”Ÿçš®è‚¤ç™½çš™ä¸è¦å‘é»„\n- å¦‚æœä¸Šè£…æœ‰å¤šå±‚ï¼ˆå¦‚å¤–å¥—+å†…æ­ï¼‰ï¼Œè¯·åˆ†åˆ«è¯¦ç»†æè¿°æ¯ä¸€å±‚\n\nè¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œå°½å¯èƒ½è¯¦ç»†å’Œå‡†ç¡®ã€‚"
        },
        {
          "type": "image_url",
          "image_url": {
            "url": "={{ $json.uploadedUrl }}"
          }
        }
      ]
    }
  ],
  "max_tokens": 4000,
  "temperature": 0.7
}
```

**è¾“å‡º**:
```json
{
  "clothingAnalysis": "={{ $json.choices[0].message.content }}"
}
```

---

### 4. è·å–æ¨¡ç‰¹å›¾ç‰‡URL (Function)

**èŠ‚ç‚¹ç±»å‹**: Function/Code

**ä»£ç **:
```javascript
const character = $input.item.json.character;
const modelBaseUrl = $env.R2_MODEL_BASE_URL || $env.R2_PUBLIC_BASE_URL;

// å›ºå®šä½¿ç”¨ frame_1.jpg
const modelImageUrl = `${modelBaseUrl}/${character}/frame_1.jpg`;

return {
  json: {
    modelImageUrl: modelImageUrl,
    character: character
  }
};
```

---

### 5. KIEåˆ›å»ºå›¾ç‰‡ç”Ÿæˆä»»åŠ¡ (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "POST",
  "url": "https://api.kie.ai/api/v1/jobs/createTask",
  "authentication": "genericCredentialType",
  "genericAuthType": "httpHeaderAuth",
  "sendHeaders": true,
  "headerParameters": {
    "parameters": [
      {
        "name": "Authorization",
        "value": "Bearer {{ $env.KIE_API_TOKEN }}"
      },
      {
        "name": "Content-Type",
        "value": "application/json"
      }
    ]
  },
  "sendBody": true,
  "bodyContentType": "json"
}
```

**è¯·æ±‚ä½“æ„å»ºé€»è¾‘**:
```javascript
// åœ¨ Function èŠ‚ç‚¹ä¸­å‡†å¤‡è¯·æ±‚ä½“
const clothingAnalysis = $input.item.json.clothingAnalysis;
const modelImageUrl = $input.item.json.modelImageUrl;
const extractTopOnly = $input.item.json.extractTopOnly || false;
const wearMask = $input.item.json.wearMask || false;

// é€‰æ‹©prompt
const basePrompt = extractTopOnly
  ? `ä¿æŒäººç‰©èº«æä¸€è‡´ï¼ˆä¸°ç›ˆæ›²çº¿ã€å°è›®è…°ã€å®½èƒ¯ï¼‰ï¼ŒèƒŒæ™¯ä¸å˜ï¼Œå…‰å½±è‡ªç„¶ï¼›
çš®è‚¤æ•´ä½“é›ªç™½é€šé€ï¼Œè£¸éœ²è‚Œè‚¤åœ¨æŸ”å’Œå…‰çº¿ç…§å°„ä¸‹æ³›ç€ç»†è…»çš„äº®åº¦ï¼›
è‚¤è‰²è¦ç™½çš™ä½†ä¸è¿‡æ›ï¼Œä¸åè“ï¼Œæ•´ä½“å‘ˆæŸ”å…‰ç¾æ„Ÿã€‚

æ ¸å¿ƒè¦æ±‚ - å¿…é¡»ä¸¥æ ¼éµå®ˆï¼š
1. **å®Œå…¨ä¿æŒæ¨¡ç‰¹çš„èº«ææ¯”ä¾‹ã€ä½“å‹å’Œèº«é«˜** - ä¸è¦æ”¹å˜æ¨¡ç‰¹çš„èƒ–ç˜¦ã€èº«ææ›²çº¿ã€è‚©å®½ã€è…°å›´ç­‰ä»»ä½•èº«ä½“ç‰¹å¾
2. **å®Œå…¨ä¿æŒæ¨¡ç‰¹çš„é¢éƒ¨ç‰¹å¾ã€è‚¤è‰²å’Œå‘å‹** - äº”å®˜ã€è‚¤è‰²ã€å‘è‰²ã€å‘å‹å¿…é¡»ä¸åŸå›¾ä¸€è‡´
3. **è‚¤è‰²è¦æ±‚ï¼šè£¸éœ²çš„çš®è‚¤ï¼ˆå¦‚é¢éƒ¨ã€æ‰‹è‡‚ã€è…¿éƒ¨ç­‰ï¼‰è¦ç™½çš™é€šé€ï¼Œä¸è¦å‘é»„æˆ–æš—æ²‰** - æ‰€æœ‰è£¸éœ²çš®è‚¤è¦å‘ˆç°å¥åº·çš„ç™½çš™è‰²è°ƒ
4. **å¿…é¡»ä¿æŒåŸå›¾çš„èƒŒæ™¯ç¯å¢ƒå®Œå…¨ä¸å˜** - èƒŒæ™¯ã€åœºæ™¯ã€é“å…·ç­‰å®Œå…¨ä¸å˜
5. **ä¿æŒæ¨¡ç‰¹çš„å§¿æ€ã€åŠ¨ä½œå’Œè¡¨æƒ…** - ç«™å§¿ã€æ‰‹åŠ¿ã€è¡¨æƒ…ç­‰å®Œå…¨ä¸€è‡´

æœè£…æ›¿æ¢è¦æ±‚ - **åªæ”¹å˜ä¸Šè£…**ï¼š
1. **åªæ›¿æ¢ä¸Šè£…ï¼ˆä¸Šè¡£ã€å¤–å¥—ã€è¡¬è¡«ç­‰ï¼‰** - ä»…æ”¹å˜ä¸ŠåŠèº«çš„è¡£æœ
2. **å®Œå…¨ä¿æŒä¸‹è£…ä¸å˜** - è£¤å­ã€è£™å­ã€çŸ­è£¤ç­‰ä¸‹è£…å¿…é¡»ä¸åŸå›¾å®Œå…¨ä¸€è‡´
3. **å®Œå…¨ä¿æŒé‹å­ä¸å˜** - å¦‚æœåŸå›¾ä¸­æœ‰é‹å­ï¼Œå¿…é¡»ä¿æŒé‹å­ä¸åŸå›¾å®Œå…¨ä¸€è‡´
4. **å®Œå…¨ä¿æŒä¸è¢œ/æ‰“åº•è£¤ä¸å˜** - å¦‚æœåŸå›¾ä¸­æœ‰ä¸è¢œæˆ–æ‰“åº•è£¤ï¼Œå¿…é¡»ä¿æŒä¸åŸå›¾å®Œå…¨ä¸€è‡´
5. **å®Œå…¨ä¿æŒé…é¥°ä¸å˜** - åŒ…åŒ…ã€å¸½å­ã€çœ¼é•œã€è…°å¸¦ç­‰é…é¥°å¿…é¡»ä¸åŸå›¾å®Œå…¨ä¸€è‡´
6. æ–°ä¸Šè£…è¦è‡ªç„¶è´´åˆæ¨¡ç‰¹èº«æï¼Œç¬¦åˆåŸæœ‰çš„èº«ä½“æ›²çº¿
7. æ³¨æ„å…‰å½±å’Œæè´¨ç»†èŠ‚ï¼Œç¡®ä¿æ–°ä¸Šè£…ä¸åŸèƒŒæ™¯çš„å…‰çº¿åè°ƒä¸€è‡´
8. ä¸Šè£…è¦ä¸åŸæœ‰çš„ä¸‹è£…æ­é…åè°ƒï¼Œæ•´ä½“çœ‹èµ·æ¥å’Œè°è‡ªç„¶

ä¸Šè£…æè¿°:`
  : `ä¿æŒäººç‰©èº«æä¸€è‡´ï¼ˆä¸°ç›ˆæ›²çº¿ã€å°è›®è…°ã€å®½èƒ¯ï¼‰ï¼ŒèƒŒæ™¯ä¸å˜ï¼Œå…‰å½±è‡ªç„¶ï¼›
çš®è‚¤æ•´ä½“é›ªç™½é€šé€ï¼Œè£¸éœ²è‚Œè‚¤åœ¨æŸ”å’Œå…‰çº¿ç…§å°„ä¸‹æ³›ç€ç»†è…»çš„äº®åº¦ï¼›
è‚¤è‰²è¦ç™½çš™ä½†ä¸è¿‡æ›ï¼Œä¸åè“ï¼Œæ•´ä½“å‘ˆæŸ”å…‰ç¾æ„Ÿã€‚

æ ¸å¿ƒè¦æ±‚ - å¿…é¡»ä¸¥æ ¼éµå®ˆï¼š
1. **å®Œå…¨ä¿æŒæ¨¡ç‰¹çš„èº«ææ¯”ä¾‹ã€ä½“å‹å’Œèº«é«˜** - ä¸è¦æ”¹å˜æ¨¡ç‰¹çš„èƒ–ç˜¦ã€èº«ææ›²çº¿ã€è‚©å®½ã€è…°å›´ç­‰ä»»ä½•èº«ä½“ç‰¹å¾
2. **å®Œå…¨ä¿æŒæ¨¡ç‰¹çš„é¢éƒ¨ç‰¹å¾ã€è‚¤è‰²å’Œå‘å‹** - äº”å®˜ã€è‚¤è‰²ã€å‘è‰²ã€å‘å‹å¿…é¡»ä¸åŸå›¾ä¸€è‡´
3. **è‚¤è‰²è¦æ±‚ï¼šè£¸éœ²çš„çš®è‚¤ï¼ˆå¦‚é¢éƒ¨ã€æ‰‹è‡‚ã€è…¿éƒ¨ç­‰ï¼‰è¦ç™½çš™é€šé€ï¼Œä¸è¦å‘é»„æˆ–æš—æ²‰** - æ‰€æœ‰è£¸éœ²çš®è‚¤è¦å‘ˆç°å¥åº·çš„ç™½çš™è‰²è°ƒ
4. **å¿…é¡»ä¿æŒåŸå›¾çš„èƒŒæ™¯ç¯å¢ƒå®Œå…¨ä¸å˜** - èƒŒæ™¯ã€åœºæ™¯ã€é“å…·ç­‰å®Œå…¨ä¸å˜
5. **ä¿æŒæ¨¡ç‰¹çš„å§¿æ€ã€åŠ¨ä½œå’Œè¡¨æƒ…** - ç«™å§¿ã€æ‰‹åŠ¿ã€è¡¨æƒ…ç­‰å®Œå…¨ä¸€è‡´

æœè£…æ›¿æ¢è¦æ±‚ï¼š
1. **åªæ›¿æ¢æœè£…** - ä»…æ”¹å˜è¡£æœã€è£¤å­ã€é‹å­ç­‰æœè£…å•å“
2. **é‹å­å¤„ç†è§„åˆ™**ï¼š
   - å¦‚æœæœè£…æè¿°ä¸­åŒ…å«é‹å­çš„è¯¦ç»†ä¿¡æ¯ï¼šå¿…é¡»åœ¨ç”Ÿæˆçš„å›¾ç‰‡ä¸­å±•ç¤ºé‹å­
   - å¦‚æœæœè£…æè¿°ä¸­æ²¡æœ‰æåŠé‹å­ï¼šåˆ™ä¸è¦åœ¨ç”Ÿæˆçš„å›¾ç‰‡ä¸­å±•ç¤ºé‹å­
3. æœè£…è¦è‡ªç„¶è´´åˆæ¨¡ç‰¹èº«æï¼Œç¬¦åˆåŸæœ‰çš„èº«ä½“æ›²çº¿
4. æ³¨æ„å…‰å½±å’Œæè´¨ç»†èŠ‚ï¼Œç¡®ä¿æ–°æœè£…ä¸åŸèƒŒæ™¯çš„å…‰çº¿åè°ƒä¸€è‡´
5. æ ¹æ®æœè£…æè¿°çš„å†…å®¹ç”Ÿæˆç›¸åº”çš„æ­é…

æœè£…æè¿°:`;

// å¦‚æœéœ€è¦æˆ´å£ç½©ï¼Œæ·»åŠ å£ç½©è¦æ±‚
const clothingWithMask = wearMask
  ? `${clothingAnalysis}\n\nç‰¹åˆ«è¦æ±‚ï¼šæ¨¡ç‰¹ä½©æˆ´ç™½è‰²å£ç½©ã€‚`
  : clothingAnalysis;

const fullPrompt = basePrompt + clothingWithMask;

return {
  json: {
    model: 'google/nano-banana-edit',
    callBackUrl: $env.KIE_CALLBACK_URL || '',
    input: {
      prompt: fullPrompt,
      image_urls: [modelImageUrl],
      output_format: 'png',
      image_size: '9:16'
    }
  }
};
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "taskId": "task_xxxxx"
  }
}
```

---

### 6. è½®è¯¢ä»»åŠ¡çŠ¶æ€ (Loop + HTTP Request + Wait)

**èŠ‚ç‚¹ç±»å‹**: Loop Until

**é…ç½®**:
- **æœ€å¤§è¿­ä»£æ¬¡æ•°**: 30
- **å¾ªç¯æ¡ä»¶**: `{{ $json.status !== 'success' && $json.status !== 'failed' }}`

**6a. ç­‰å¾…èŠ‚ç‚¹ (Wait)**
```json
{
  "unit": "seconds",
  "amount": 2
}
```

**6b. æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ (HTTP Request)**
```json
{
  "method": "GET",
  "url": "https://api.kie.ai/api/v1/jobs/getTask?taskId={{ $json.taskId }}",
  "authentication": "genericCredentialType",
  "genericAuthType": "httpHeaderAuth",
  "sendHeaders": true,
  "headerParameters": {
    "parameters": [
      {
        "name": "Authorization",
        "value": "Bearer {{ $env.KIE_API_TOKEN }}"
      }
    ]
  }
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "taskId": "task_xxxxx",
    "state": "success",
    "resultJson": "{\"resultUrls\":[\"https://...\"]}"
  }
}
```

---

### 7. æå–ç»“æœURL (Function)

**èŠ‚ç‚¹ç±»å‹**: Function/Code

**ä»£ç **:
```javascript
const data = $input.item.json.data;
const resultJson = JSON.parse(data.resultJson);

if (!resultJson.resultUrls || resultJson.resultUrls.length === 0) {
  throw new Error('No result URLs found');
}

return {
  json: {
    generatedImageUrl: resultJson.resultUrls[0],
    allResultUrls: resultJson.resultUrls,
    taskId: data.taskId
  }
};
```

---

### 8. ä¸‹è½½ç”Ÿæˆçš„å›¾ç‰‡ (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "GET",
  "url": "={{ $json.generatedImageUrl }}",
  "responseFormat": "file",
  "dataPropertyName": "generatedImage"
}
```

---

### 9. ç”Ÿæˆå°çº¢ä¹¦æ ‡é¢˜ (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "POST",
  "url": "https://openrouter.ai/api/v1/chat/completions",
  "authentication": "genericCredentialType",
  "genericAuthType": "httpHeaderAuth",
  "sendHeaders": true,
  "headerParameters": {
    "parameters": [
      {
        "name": "Authorization",
        "value": "Bearer {{ $env.OPENROUTER_API_KEY }}"
      },
      {
        "name": "HTTP-Referer",
        "value": "{{ $env.SITE_URL }}"
      },
      {
        "name": "X-Title",
        "value": "{{ $env.SITE_NAME }}"
      }
    ]
  },
  "sendBody": true,
  "bodyContentType": "json"
}
```

**è¯·æ±‚ä½“**:
```json
{
  "model": "openai/gpt-4o",
  "messages": [
    {
      "role": "user",
      "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å°çº¢ä¹¦å†…å®¹åˆ›ä½œä¸“å®¶ï¼Œæ“…é•¿åˆ›ä½œå¸å¼•çœ¼çƒçš„çˆ†æ¬¾æ ‡é¢˜ã€‚\n\nè¯·æ ¹æ®ä»¥ä¸‹æœè£…æè¿°ï¼Œåˆ›ä½œä¸€ä¸ªç¬¦åˆå°çº¢ä¹¦é£æ ¼çš„çˆ†æ¬¾æ ‡é¢˜ã€‚\n\nã€æ ‡é¢˜å…¬å¼ã€‘\nä¸»æ ‡é¢˜ï¼šã€”å½¢å®¹è¯+å•å“ã€•âœ–ï¸ã€”æ•°å­—ç¬¦å·ã€•ï¼ï¼ã€”æƒ…ç»ªå¥/ç–‘é—®å¥ã€•\nå‰¯æ ‡é¢˜ï¼š10ä¸ªè¯é¢˜æ ‡ç­¾\n\nã€åˆ›ä½œè¦æ±‚ã€‘\n1. ä¸»æ ‡é¢˜è¦æœ‰å†²å‡»åŠ›å’Œå¸å¼•åŠ›ï¼Œä½¿ç”¨å¤¸å¼ ä½†ä¸æµ®å¤¸çš„è¡¨è¾¾\n2. æ•°å­—ç¬¦å·è¦é€‰æ‹©ä¸æœè£…é£æ ¼åŒ¹é…çš„emojiï¼ˆå¦‚ï¼šâ¤ï¸ã€âš¡ã€ğŸ”¥ã€âœ¨ã€ğŸ’«ç­‰ï¼‰\n3. æƒ…ç»ªå¥/ç–‘é—®å¥è¦èƒ½å¼•èµ·å…±é¸£ï¼ˆå¦‚ï¼šè°æ‡‚å•Šï¼çœŸçš„ç»äº†ï¼ä½ è¿˜ä¸çŸ¥é“å—ï¼Ÿå§å¦¹ä»¬å†²ï¼ï¼‰\n4. è¯é¢˜æ ‡ç­¾è¦ç²¾å‡†ä¸”æœ‰æµé‡ï¼ˆ10ä¸ªæ ‡ç­¾ï¼Œæ¯ä¸ªéƒ½è¦åŠ #ï¼‰\n\nã€è¾“å‡ºæ ¼å¼ã€‘\nåªè¾“å‡ºæ ‡é¢˜å†…å®¹ï¼Œä¸è¦ä»»ä½•è§£é‡Šè¯´æ˜ã€‚æ ¼å¼å¦‚ä¸‹ï¼š\n\nã€ä¸»æ ‡é¢˜å†…å®¹ã€‘\n\n#æ ‡ç­¾1 #æ ‡ç­¾2 #æ ‡ç­¾3 #æ ‡ç­¾4 #æ ‡ç­¾5 #æ ‡ç­¾6 #æ ‡ç­¾7 #æ ‡ç­¾8 #æ ‡ç­¾9 #æ ‡ç­¾10\n\n---\n\nç°åœ¨è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆæ ‡é¢˜ï¼š\næœè£…æè¿°ï¼š{{ $json.clothingAnalysis }}"
    }
  ],
  "max_tokens": 2000,
  "temperature": 0.8
}
```

**è¾“å‡º**:
```json
{
  "xiaohongshuTitle": "={{ $json.choices[0].message.content.trim() }}"
}
```

---

### 10. ä¸Šä¼ ç”Ÿæˆå›¾ç‰‡åˆ°R2 (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "PUT",
  "url": "https://{{ $env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com/{{ $env.R2_BUCKET_NAME }}/generated/{{ $json.character }}/{{ $now.format('YYYY-MM-DD-HH-mm-ss') }}-{{ $randomUUID() }}.png",
  "authentication": "genericCredentialType",
  "genericAuthType": "awsS3",
  "sendBody": true,
  "bodyContentType": "raw",
  "rawBody": "={{ $binary.generatedImage.data }}"
}
```

---

### 11. ä¿å­˜å…ƒæ•°æ®åˆ°R2 (HTTP Request)

**èŠ‚ç‚¹ç±»å‹**: HTTP Request

**é…ç½®**:
```json
{
  "method": "PUT",
  "url": "https://{{ $env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com/{{ $env.R2_BUCKET_NAME }}/generated/{{ $json.character }}/{{ $json.imageKey }}.json",
  "authentication": "genericCredentialType",
  "genericAuthType": "awsS3",
  "sendBody": true,
  "bodyContentType": "json"
}
```

**è¯·æ±‚ä½“**:
```json
{
  "createdAt": "={{ $now.toISOString() }}",
  "character": "={{ $json.character }}",
  "source": {
    "key": "={{ $json.sourceKey }}",
    "url": "={{ $json.sourceUrl }}",
    "filename": "={{ $json.sourceFilename }}"
  },
  "imageKey": "={{ $json.generatedImageKey }}",
  "imageUrl": "={{ $json.generatedImageUrl }}",
  "analysis": "={{ $json.clothingAnalysis }}",
  "xiaohongshuTitle": "={{ $json.xiaohongshuTitle }}"
}
```

---

### 12. è¿”å›ç»“æœ (Respond to Webhook)

**èŠ‚ç‚¹ç±»å‹**: Respond to Webhook

**é…ç½®**:
```json
{
  "options": {
    "responseCode": 200
  }
}
```

**å“åº”ä½“**:
```json
{
  "success": true,
  "character": "={{ $json.character }}",
  "generated": {
    "imageUrl": "={{ $json.generatedImageUrl }}",
    "imageKey": "={{ $json.generatedImageKey }}",
    "metadataUrl": "={{ $json.metadataUrl }}",
    "xiaohongshuTitle": "={{ $json.xiaohongshuTitle }}",
    "analysis": "={{ $json.clothingAnalysis }}"
  },
  "taskId": "={{ $json.taskId }}"
}
```

---

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹ (JSON)

ä»¥ä¸‹æ˜¯å®Œæ•´çš„ n8n workflow JSONï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥åˆ° n8nï¼š

```json
{
  "name": "æ¨¡ç‰¹æ¢è£…å·¥ä½œæµ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "outfit-change",
        "responseMode": "lastNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.imageUrl }}",
        "responseFormat": "file",
        "options": {}
      },
      "name": "ä¸‹è½½å‚è€ƒå›¾ç‰‡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [450, 300]
    },
    {
      "parameters": {
        "authentication": "genericCredentialType",
        "genericAuthType": "awsS3",
        "requestMethod": "PUT",
        "url": "=https://{{ $env.R2_ACCOUNT_ID }}.r2.cloudflarestorage.com/{{ $env.R2_BUCKET_NAME }}/uploads/{{ $now.format('YYYY-MM-DD') }}/{{ $randomUUID() }}.jpg",
        "sendBody": true,
        "bodyContentType": "raw",
        "rawBody": "={{ $binary.data }}"
      },
      "name": "ä¸Šä¼ åˆ°R2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [650, 300]
    },
    {
      "parameters": {
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "requestMethod": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.OPENROUTER_API_KEY }}"
            }
          ]
        },
        "sendBody": true,
        "bodyContentType": "json",
        "jsonBody": "={\n  \"model\": \"openai/gpt-4o\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": [\n        {\n          \"type\": \"text\",\n          \"text\": \"Reverse engineer this image. è¿”å›è¯¦ç»†çš„ç©¿æ­çš„prompts...\"\n        },\n        {\n          \"type\": \"image_url\",\n          \"image_url\": {\n            \"url\": \"{{ $json.uploadedUrl }}\"\n          }\n        }\n      ]\n    }\n  ],\n  \"max_tokens\": 4000,\n  \"temperature\": 0.7\n}"
      },
      "name": "GPTåˆ†ææœè£…",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [850, 300]
    },
    {
      "parameters": {
        "jsCode": "const character = $input.item.json.character;\nconst modelBaseUrl = $env.R2_MODEL_BASE_URL || $env.R2_PUBLIC_BASE_URL;\nconst randomNumber = Math.floor(Math.random() * 10) + 1;\nconst modelImageUrl = `${modelBaseUrl}/${character}/frame_${randomNumber}.jpg`;\n\nreturn {\n  json: {\n    modelImageUrl: modelImageUrl,\n    character: character\n  }\n};"
      },
      "name": "è·å–æ¨¡ç‰¹å›¾ç‰‡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "requestMethod": "POST",
        "url": "https://api.kie.ai/api/v1/jobs/createTask",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.KIE_API_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "bodyContentType": "json"
      },
      "name": "KIEåˆ›å»ºä»»åŠ¡",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.data.state }}",
              "operation": "notEquals",
              "value2": "success"
            }
          ]
        },
        "options": {
          "maxIterations": 30
        }
      },
      "name": "Loop Until Task Complete",
      "type": "n8n-nodes-base.loopUntil",
      "typeVersion": 1,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "unit": "seconds",
        "amount": 2
      },
      "name": "Wait 2s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [1650, 300]
    },
    {
      "parameters": {
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "url": "=https://api.kie.ai/api/v1/jobs/getTask?taskId={{ $json.data.taskId }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $env.KIE_API_TOKEN }}"
            }
          ]
        }
      },
      "name": "æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1850, 300]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [[{ "node": "ä¸‹è½½å‚è€ƒå›¾ç‰‡", "type": "main", "index": 0 }]]
    },
    "ä¸‹è½½å‚è€ƒå›¾ç‰‡": {
      "main": [[{ "node": "ä¸Šä¼ åˆ°R2", "type": "main", "index": 0 }]]
    },
    "ä¸Šä¼ åˆ°R2": {
      "main": [[{ "node": "GPTåˆ†ææœè£…", "type": "main", "index": 0 }]]
    },
    "GPTåˆ†ææœè£…": {
      "main": [[{ "node": "è·å–æ¨¡ç‰¹å›¾ç‰‡", "type": "main", "index": 0 }]]
    },
    "è·å–æ¨¡ç‰¹å›¾ç‰‡": {
      "main": [[{ "node": "KIEåˆ›å»ºä»»åŠ¡", "type": "main", "index": 0 }]]
    },
    "KIEåˆ›å»ºä»»åŠ¡": {
      "main": [[{ "node": "Loop Until Task Complete", "type": "main", "index": 0 }]]
    }
  }
}
```

---

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **GPTåˆ†æå¤±è´¥**
   - æ£€æŸ¥ OPENROUTER_API_KEY æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥å›¾ç‰‡URLæ˜¯å¦å¯è®¿é—®
   - ç¡®è®¤å›¾ç‰‡æ ¼å¼ä¸º JPG/PNG

2. **KIEä»»åŠ¡åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥ KIE_API_TOKEN æ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤è´¦æˆ·æœ‰è¶³å¤Ÿçš„ç§¯åˆ†
   - æ£€æŸ¥æ¨¡ç‰¹å›¾ç‰‡URLæ˜¯å¦å¯è®¿é—®

3. **ä»»åŠ¡è¶…æ—¶**
   - é»˜è®¤è½®è¯¢30æ¬¡(60ç§’)ï¼Œå¯ä»¥å¢åŠ maxAttempts
   - æ£€æŸ¥KIEæœåŠ¡çŠ¶æ€

4. **R2ä¸Šä¼ å¤±è´¥**
   - æ£€æŸ¥R2å‡­è¯æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤bucketæƒé™è®¾ç½®
   - æ£€æŸ¥bucketåç§°æ˜¯å¦æ­£ç¡®

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¹¶è¡Œå¤„ç†**: å¦‚æœæœ‰å¤šå¼ å›¾ç‰‡ï¼Œå¯ä»¥ä½¿ç”¨ Split In Batches èŠ‚ç‚¹å¹¶è¡Œå¤„ç†
2. **ç¼“å­˜æ¨¡ç‰¹å›¾ç‰‡**: é¢„å…ˆä¸‹è½½å¸¸ç”¨çš„æ¨¡ç‰¹å›¾ç‰‡åˆ°æœ¬åœ°
3. **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨webhookå›è°ƒä»£æ›¿è½®è¯¢ï¼Œæé«˜æ•ˆç‡
4. **é”™è¯¯é‡è¯•**: æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶ï¼Œæé«˜æˆåŠŸç‡

---

## æµ‹è¯•ç¤ºä¾‹

### è¾“å…¥æ•°æ®
```json
{
  "imageUrl": "https://example.com/dress.jpg",
  "character": "lin",
  "extractTopOnly": false,
  "wearMask": false
}
```

### é¢„æœŸè¾“å‡º
```json
{
  "success": true,
  "character": "lin",
  "generated": {
    "imageUrl": "https://pub-xxx.r2.dev/generated/lin/2025-01-15-12-30-45-uuid.png",
    "imageKey": "generated/lin/2025-01-15-12-30-45-uuid.png",
    "metadataUrl": "https://pub-xxx.r2.dev/generated/lin/2025-01-15-12-30-45-uuid.json",
    "xiaohongshuTitle": "ã€æ˜¾ç˜¦è¿è¡£è£™ã€‘âœ–ï¸â¤ï¸ğŸ”¥ï¼ï¼è¿™è°é¡¶å¾—ä½å•Šï¼\n\n#æ‰“å·¥äºº #æ—¥å¸¸ç©¿æ­ #æ³•å¼å¤å¤ #æ˜¾ç˜¦é®è‚‰ #OOTD #è¿è¡£è£™ #é»‘è‰²ç©¿æ­ #æ˜¥å­£ç©¿æ­ #æ¢¨å‹èº«æ #å¹³ä»·å¥½ç‰©",
    "analysis": "ä¸Šè£…ï¼šé»‘è‰²ä¿®èº«è¿è¡£è£™ï¼ŒVé¢†è®¾è®¡..."
  },
  "taskId": "task_xxxxx"
}
```

---

## é«˜çº§åŠŸèƒ½

### æ‰¹é‡å¤„ç†å¤šå¼ å›¾ç‰‡

æ·»åŠ  **Split In Batches** èŠ‚ç‚¹ï¼š

```json
{
  "parameters": {
    "batchSize": 5,
    "options": {}
  },
  "name": "Split In Batches",
  "type": "n8n-nodes-base.splitInBatches"
}
```

### Webhookå›è°ƒå¤„ç†

åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„workflowæ¥æ”¶KIEå›è°ƒï¼š

```json
{
  "parameters": {
    "httpMethod": "POST",
    "path": "kie-callback",
    "responseMode": "onReceived"
  },
  "name": "KIE Callback Webhook",
  "type": "n8n-nodes-base.webhook"
}
```

---

## å®‰å…¨å»ºè®®

1. **APIå¯†é’¥ç®¡ç†**: ä½¿ç”¨ n8n çš„ç¯å¢ƒå˜é‡æˆ–å‡­è¯å­˜å‚¨
2. **Webhookè®¤è¯**: ä¸ºwebhookæ·»åŠ è®¤è¯å¤´
3. **é€Ÿç‡é™åˆ¶**: æ·»åŠ é€Ÿç‡é™åˆ¶é˜²æ­¢æ»¥ç”¨
4. **é”™è¯¯æ—¥å¿—**: è®°å½•æ‰€æœ‰é”™è¯¯åˆ°æ—¥å¿—ç³»ç»Ÿ

---

## æ€»ç»“

è¿™ä¸ªn8nå·¥ä½œæµå®ç°äº†å®Œæ•´çš„æ¨¡ç‰¹æ¢è£…åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

âœ… å›¾ç‰‡ä¸Šä¼ å’Œå­˜å‚¨
âœ… AIæœè£…åˆ†æ (GPT-4)
âœ… AIå›¾ç‰‡ç”Ÿæˆ (KIE)
âœ… å°çº¢ä¹¦æ ‡é¢˜ç”Ÿæˆ
âœ… å…ƒæ•°æ®ç®¡ç†
âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å’Œæ‰©å±•æ­¤å·¥ä½œæµã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¥æœŸ**: 2025-01-15
**å…¼å®¹ n8n ç‰ˆæœ¬**: 1.0+
