# 智能穿搭建议优化：混搭反差 + 款式多样性

## 日期
2026-01-28

## 背景问题
1. 智能穿搭建议功能推荐的下装款式过于单一，每次都推荐相似的牛仔裤
2. 推荐的下装缺乏与上装的风格反差感
3. 生成的图片中上装款式可能与上传的衣服不一致（短款变长款等）

## 解决方案

### 1. 混搭反差原则（新增最高优先级规则）

| 上装类型 | 上装风格 | 推荐下装风格 | 具体款式示例 |
|---------|---------|------------|------------|
| 西装外套、衬衫、针织开衫等 | 正式/精致 | 休闲/街头 | 破洞牛仔裤、工装裤、直筒牛仔裤 |
| T恤、卫衣、牛仔外套等 | 休闲/街头 | 精致/有质感 | 西装裤、丝绒阔腿裤、皮裤 |
| 基础款针织衫、普通衬衫 | 中性风格 | 制造亮点 | 格纹阔腿裤、皮质铅笔裙 |

### 2. 款式多样性机制

在 prompt 中新增款式池，要求 AI 每次从池中随机选择不同款式：
- 牛仔裤类：直筒、阔腿、喇叭、锥形、破洞、老爹裤
- 西裤类：九分西装裤、阔腿西装裤、烟管裤、锥形西裤
- 休闲裤类：工装裤、灯芯绒直筒裤、运动束脚裤
- 裙装类：A字裙、百褶裙、铅笔裙、丝绒半裙、皮裙
- 特色裤类：丝绒阔腿裤、皮裤、羊毛阔腿裤

### 3. 上装款式保留强化

在生成图片的 prompt 中新增强制约束：
- 明确提取并标注上装的衣长（短款/常规/中长/长款）
- 明确提取并标注上装的版型（修身/宽松/oversized）
- 在 prompt 中加入强制约束语句，要求不得改变上装的款式和长度

## 修改的文件

| 文件 | 修改内容 |
|------|----------|
| `lib/prompts.ts` | 更新 `SMART_OUTFIT_MATCHING_PROMPT`，加入混搭反差原则、款式池、衣长描述要求 |
| `lib/ai-service.ts` | `temperature` 从 0.7 提升到 0.85，`max_tokens` 从 1000 提升到 1200 |
| `app/api/generate-outfit-auto/route.ts` | 新增 `extractTopStyleInfo()` 函数，强化 `buildEnhancedDescription()` 中的上装约束 |

## 技术细节

### SMART_OUTFIT_MATCHING_PROMPT 改动要点
1. 新增"混搭反差原则"作为最高优先级规则
2. 新增"款式多样性原则"和款式池
3. 要求服装描述中必须包含衣长、版型、正式程度信息
4. 输出格式新增"混搭体现"和"混搭风格总结"字段

### buildEnhancedDescription 改动要点
1. 新增 `extractTopStyleInfo()` 函数，从描述中提取衣长、版型信息
2. 在 enhanced description 开头加入强制约束块
3. 在结尾加入提醒，强调不得改变上装款式

## 预期效果
1. 每次推荐的下装款式都不同，有更多变化
2. 推荐的下装与上装形成强烈的风格对比（正式配休闲，休闲配精致）
3. 生成的图片中上装款式与上传的衣服保持一致
